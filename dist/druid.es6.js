// https://renecutura.eu v0.3.14 Copyright 2021 Rene Cutura
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@babel/runtime/helpers/slicedToArray"),require("@babel/runtime/helpers/classCallCheck"),require("@babel/runtime/helpers/createClass"),require("@babel/runtime/helpers/toConsumableArray"),require("@babel/runtime/regenerator"),require("@babel/runtime/helpers/assertThisInitialized"),require("@babel/runtime/helpers/inherits"),require("@babel/runtime/helpers/possibleConstructorReturn"),require("@babel/runtime/helpers/getPrototypeOf"),require("@babel/runtime/helpers/construct"),require("@babel/runtime/helpers/asyncToGenerator"),require("@babel/runtime/helpers/set"),require("@babel/runtime/helpers/awaitAsyncGenerator"),require("@babel/runtime/helpers/wrapAsyncGenerator")):"function"==typeof define&&define.amd?define(["exports","@babel/runtime/helpers/slicedToArray","@babel/runtime/helpers/classCallCheck","@babel/runtime/helpers/createClass","@babel/runtime/helpers/toConsumableArray","@babel/runtime/regenerator","@babel/runtime/helpers/assertThisInitialized","@babel/runtime/helpers/inherits","@babel/runtime/helpers/possibleConstructorReturn","@babel/runtime/helpers/getPrototypeOf","@babel/runtime/helpers/construct","@babel/runtime/helpers/asyncToGenerator","@babel/runtime/helpers/set","@babel/runtime/helpers/awaitAsyncGenerator","@babel/runtime/helpers/wrapAsyncGenerator"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).druid=t.druid||{},t._slicedToArray,t._classCallCheck,t._createClass,t._toConsumableArray,t._regeneratorRuntime,t._assertThisInitialized,t._inherits,t._possibleConstructorReturn,t._getPrototypeOf,t._construct,t._asyncToGenerator,t._set,null,t._wrapAsyncGenerator)}(this,(function(t,r,a,i,o,u,l,c,h,_,d,v,y,m,g){"use strict";function _interopDefaultLegacy(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var w=_interopDefaultLegacy(r),b=_interopDefaultLegacy(a),k=_interopDefaultLegacy(i),A=_interopDefaultLegacy(o),M=_interopDefaultLegacy(u),x=_interopDefaultLegacy(l),S=_interopDefaultLegacy(c),T=_interopDefaultLegacy(h),$=_interopDefaultLegacy(_),R=_interopDefaultLegacy(d),L=_interopDefaultLegacy(v),I=_interopDefaultLegacy(y),j=_interopDefaultLegacy(g);function euclidean(t,r){return Math.sqrt(euclidean_squared(t,r))}function neumair_sum(t){for(var r=t.length,a=0,i=0,o=0;o<r;++o){var u=t[o],l=a+u;Math.abs(a)>=Math.abs(u)?i+=a-l+u:i+=u-l+a,a=l}return a+i}function euclidean_squared(t,r){if(t.length==r.length){for(var a=t.length,i=new Array(a),o=0;o<a;++o){var u=t[o],l=r[o];i[o]=(u-l)*(u-l)}return neumair_sum(i)}}function k_nearest_neighbors(t,r){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:euclidean,o=t.shape[0],u=null!=a?a:distance_matrix(t,i),l=new Array(o),c=function _loop(t){l[t]=Array.from(u.row(t)).map((function(r,a){return{i:t,j:a,distance:r}})).sort((function(t,r){return t.distance-r.distance})).slice(1,r+1)},h=0;h<o;++h)c(h);return l}function _createForOfIteratorHelper$7(t,r){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function _unsupportedIterableToArray$7(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$7(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray$7(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var i=0,o=function F(){};return{s:o,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){a=t[Symbol.iterator]()},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==a.return||a.return()}finally{if(c)throw u}}}}function _arrayLikeToArray$7(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=t[a];return i}var O=function(){function Matrix(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(b.default(this,Matrix),this._rows=t,this._cols=r,this._data=null,t&&r){if(!a)return this._data=new Float64Array(t*r),this;if("function"==typeof a){this._data=new Float64Array(t*r);for(var i=0;i<t;++i)for(var o=0;o<r;++o)this._data[i*r+o]=a(i,o);return this}if("string"==typeof a){if("zeros"===a)return new Matrix(t,r,0);if("identity"===a||"I"===a){this._data=new Float64Array(t*r);for(var u=0;u<t;++u)this._data[u*r+u]=1;return this}if("center"===a&&t==r){this._data=new Float64Array(t*r),a=function value(r,a){return(r===a?1:0)-1/t};for(var l=0;l<t;++l)for(var c=0;c<r;++c)this._data[l*r+c]=a(l,c);return this}}if("number"==typeof a){this._data=new Float64Array(t*r);for(var h=0;h<t;++h)for(var _=0;_<r;++_)this._data[h*r+_]=a;return this}}return this}return k.default(Matrix,[{key:"row",value:function row(t){var r=this._data,a=this._cols;return r.subarray(t*a,(t+1)*a)}},{key:"iterate_rows",value:M.default.mark((function iterate_rows(){var t,r,a,i;return M.default.wrap((function iterate_rows$(o){for(;;)switch(o.prev=o.next){case 0:t=this._cols,r=this._rows,a=this._data,i=0;case 4:if(!(i<r)){o.next=10;break}return o.next=7,a.subarray(i*t,(i+1)*t);case 7:++i,o.next=4;break;case 10:case"end":return o.stop()}}),iterate_rows,this)}))},{key:Symbol.iterator,value:M.default.mark((function value(){var t,r,a;return M.default.wrap((function value$(i){for(;;)switch(i.prev=i.next){case 0:t=_createForOfIteratorHelper$7(this.iterate_rows()),i.prev=1,t.s();case 3:if((r=t.n()).done){i.next=9;break}return a=r.value,i.next=7,a;case 7:i.next=3;break;case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),t.e(i.t0);case 14:return i.prev=14,t.f(),i.finish(14);case 17:case"end":return i.stop()}}),value,this,[[1,11,14,17]])}))},{key:"set_row",value:function set_row(t,r){var a=this._cols;if(Array.isArray(r)&&r.length===a)for(var i=t*a,o=0;o<a;++o)this._data[i+o]=r[o];else if(r instanceof Matrix&&r.shape[1]===a&&1===r.shape[0])for(var u=t*a,l=0;l<a;++l)this._data[u+l]=r._data[l];return this}},{key:"col",value:function col(t){for(var r=new Float64Array(this._rows),a=0;a<this._rows;++a)r[a]=this._data[a*this._cols+t];return r}},{key:"entry",value:function entry(t,r){return this._data[t*this._cols+r]}},{key:"set_entry",value:function set_entry(t,r,a){return this._data[t*this._cols+r]=a,this}},{key:"transpose",value:function transpose(){var t=this;return new Matrix(this._cols,this._rows,(function(r,a){return t.entry(a,r)}))}},{key:"T",get:function get(){return this.transpose()}},{key:"inverse",value:function inverse(){for(var t=this,r=this._rows,a=this._cols,i=new Matrix(r,2*a,(function(r,i){return i>=a?r===i-a?1:0:t.entry(r,i)})),o=0,u=0;o<r&&u<a;){for(var l=0,c=-1/0,h=o;h<r;++h){var _=Math.abs(i.entry(h,u));c<_&&(l=h,c=_)}if(0==i.entry(l,u))u++;else{for(var d=0;d<2*a;++d){var v=i.entry(o,d),y=i.entry(l,d);i.set_entry(o,d,v),i.set_entry(l,d,y)}for(var m=o+1;m<r;++m){var g=i.entry(m,u)/i.entry(o,u);i.set_entry(m,u,0);for(var w=u+1;w<2*a;++w)i.set_entry(m,w,i.entry(m,w)-i.entry(o,w)*g)}o++,u++}}for(var b=0;b<r;++b)for(var k=i.entry(b,b),A=b;A<2*a;++A)i.set_entry(b,A,i.entry(b,A)/k);for(var M=r-1;M>=0;--M)for(var x=i.entry(M,M),S=0;S<M;S++)for(var T=i.entry(S,M)/x,$=S;$<2*a;++$){var R=i.entry(S,$);R-=i.entry(M,$)*T,i.set_entry(S,$,R)}return new Matrix(r,a,(function(t,r){return i.entry(t,r+a)}))}},{key:"dot",value:function dot(t){var r=this;if(t instanceof Matrix){var a=this;if(a.shape[1]!==t.shape[0])throw"A.dot(B): A is a ".concat(a.shape.join(" x "),"-Matrix, B is a ").concat(t.shape.join(" x "),"-Matrix: \n                A has ").concat(a.shape[1]," cols and B ").concat(t.shape[0]," rows. \n                Must be equal!");var i=a.shape[1];return new Matrix(a.shape[0],t.shape[1],(function(r,o){for(var u=a.row(r),l=t.col(o),c=0,h=0;h<i;++h)c+=u[h]*l[h];return c}))}if(Array.isArray(t)||t instanceof Float64Array){var o=this._rows;if(t.length!==o)throw"A.dot(B): A has ".concat(o," cols and B has ").concat(t.length," rows. Must be equal!");for(var u=new Array(o),l=function _loop(a){u[a]=neumair_sum(r.row(a).map((function(r){return r*t[a]})))},c=0;c<o;++c)l(c);return u}throw"B must be Matrix or Array"}},{key:"outer",value:function outer(t){var r=this,a=r._data.length;if(a==t._data.length){var i=new Matrix;return i.shape=[a,a,function(a,o){return a<=o?r._data[a]*t._data[o]:i.entry(o,a)}],i}}},{key:"concat",value:function concat(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"horizontal",a=this,i=w.default(a.shape,2),o=i[0],u=i[1],l=w.default(t.shape,2),c=l[0],h=l[1];if("horizontal"==r){if(o!=c)throw'A.concat(B, "horizontal"): A and B need same number of rows, A has '.concat(o," rows, B has ").concat(c," rows.");var _=new Matrix(o,u+h,"zeros");return _.set_block(0,0,a),_.set_block(0,u,t),_}if("vertical"==r){if(u!=h)throw'A.concat(B, "vertical"): A and B need same number of columns, A has '.concat(u," columns, B has ").concat(h," columns.");var d=new Matrix(o+c,u,"zeros");return d.set_block(0,0,a),d.set_block(o,0,t),d}if("diag"==r){var v=new Matrix(o+c,u+h,"zeros");return v.set_block(0,0,a),v.set_block(o,u,t),v}throw'type must be "horizontal" or "vertical", but type is '.concat(r,"!")}},{key:"set_block",value:function set_block(t,r,a){for(var i=w.default(a.shape,2),o=i[0],u=i[1],l=0;l<o;++l)if(!(l>this._rows))for(var c=0;c<u;++c)c>this._cols||this.set_entry(l+t,c+r,a.entry(l,c));return this}},{key:"get_block",value:function get_block(t,r){var a,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=w.default(this.shape,2),c=l[0],h=l[1];if(u=null!==(i=u)&&void 0!==i?i:h,(o=null!==(a=o)&&void 0!==a?a:c)<=t||u<=r)throw"\n                end_row must be greater than start_row, and \n                end_col must be greater than start_col, but\n                end_row = ".concat(o,", start_row = ").concat(t,", end_col = ").concat(u,", and start_col = ").concat(r,"!");for(var _=new Matrix(o-t,u-r,"zeros"),d=t,v=0;d<o;++d,++v)for(var y=r,m=0;y<u;++y,++m)_.set_entry(v,m,this.entry(d,y));return _}},{key:"gather",value:function gather(t,r){for(var a=t.length,i=new Matrix(a,r.length),o=0;o<a;++o)for(var u=t[o],l=0;l<a;++l){var c=r[l];i.set_entry(o,l,this.entry(u,c))}return i}},{key:"_apply_array",value:function _apply_array(t,r){for(var a=this._data,i=w.default(this.shape,2),o=i[0],u=i[1],l=0;l<o;++l)for(var c=l*u,h=0;h<u;++h){var _=c+h;a[_]=t(a[_],r(l,h))}return this}},{key:"_apply_rowwise_array",value:function _apply_rowwise_array(t,r){return this._apply_array(r,(function(r,a){return t[a]}))}},{key:"_apply_colwise_array",value:function _apply_colwise_array(t,r){for(var a=this._data,i=w.default(this.shape,2),o=i[0],u=i[1],l=0;l<o;++l)for(var c=l*u,h=0;h<u;++h){var _=c+h;a[_]=r(a[_],t[l])}return this}},{key:"_apply",value:function _apply(t,r){var a=this._data;if(t instanceof Matrix){var i=w.default(t.shape,2),o=i[0],u=i[1],l=w.default(this.shape,2),c=l[0],h=l[1];if(1===o){if(h!==u)throw"cols !== value_cols";for(var _=0;_<c;++_)for(var d=0;d<h;++d)a[_*h+d]=r(a[_*h+d],t.entry(0,d))}else if(1===u){if(c!==o)throw"rows !== value_rows";for(var v=0;v<c;++v)for(var y=0;y<h;++y)a[v*h+y]=r(a[v*h+y],t.entry(v,0))}else{if(c!=o||h!=u)throw"error";for(var m=0;m<c;++m)for(var g=0;g<h;++g)a[m*h+g]=r(a[m*h+g],t.entry(m,g))}}else if(Array.isArray(t)){var b=this._rows,k=this._cols;if(t.length===b)for(var A=0;A<b;++A)for(var M=0;M<k;++M)a[A*k+M]=r(a[A*k+M],t[A]);else{if(t.length!==k)throw"error";for(var x=0;x<b;++x)for(var S=0;S<k;++S)a[x*k+S]=r(a[x*k+S],t[S])}}else for(var T=0,$=this._rows*this._cols;T<$;++T)a[T]=r(a[T],t);return this}},{key:"clone",value:function clone(){var t=new Matrix;return t._rows=this._rows,t._cols=this._cols,t._data=this._data.slice(0),t}},{key:"mult",value:function mult(t){return this.clone()._apply(t,(function(t,r){return t*r}))}},{key:"divide",value:function divide(t){return this.clone()._apply(t,(function(t,r){return t/r}))}},{key:"add",value:function add(t){return this.clone()._apply(t,(function(t,r){return t+r}))}},{key:"sub",value:function sub(t){return this.clone()._apply(t,(function(t,r){return t-r}))}},{key:"shape",get:function get(){return[this._rows,this._cols]}},{key:"shape",set:function set(t){var r=w.default(t,3),a=r[0],i=r[1],o=r[2],u=void 0===o?function(){return 0}:o;this._rows=a,this._cols=i,this._data=new Float64Array(a*i);for(var l=0;l<a;++l)for(var c=0;c<i;++c)this._data[l*i+c]=u(l,c);return this}},{key:"to2dArray",get:function get(){return A.default(this.iterate_rows())}},{key:"diag",get:function get(){for(var t=this._rows,r=this._cols,a=Math.min(t,r),i=new Float64Array(a),o=0;o<a;++o)i[o]=this.entry(o,o);return i}},{key:"mean",get:function get(){return this.sum/(this._rows*this._cols)}},{key:"sum",get:function get(){return neumair_sum(this._data)}},{key:"meanRows",get:function get(){for(var t=this._data,r=this._rows,a=this._cols,i=Float64Array.from({length:r}),o=0;o<r;++o){i[o]=0;for(var u=0;u<a;++u)i[o]+=t[o*a+u];i[o]/=a}return i}},{key:"meanCols",get:function get(){for(var t=this._data,r=this._rows,a=this._cols,i=Float64Array.from({length:a}),o=0;o<a;++o){i[o]=0;for(var u=0;u<r;++u)i[o]+=t[u*a+o];i[o]/=r}return i}}],[{key:"from",value:function from(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";if(t instanceof Matrix)return t.clone();if(!(Array.isArray(t)||t instanceof Float64Array)){if("number"==typeof t)return new Matrix(1,1,t);throw"error"}var a=t.length;if(0===a)throw"Array is empty";if(!(Array.isArray(t[0])||t[0]instanceof Float64Array)){if("row"===r)return new Matrix(1,a,(function(r,a){return t[a]}));if("col"===r)return new Matrix(a,1,(function(r){return t[r]}));if("diag"===r)return new Matrix(a,a,(function(r,a){return r==a?t[r]:0}));throw"1d array has NaN entries"}if(Array.isArray(t[0])||t[0]instanceof Float64Array){for(var i=t[0].length,o=0;o<a;++o)if(t[o].length!==i)throw"various array lengths";return new Matrix(a,i,(function(r,a){return t[r][a]}))}}},{key:"solve_CG",value:function solve_CG(t,r,a){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001,o=t.shape[0],u=r.shape[1],l=new Matrix(o,0),c=0;c<u;++c){var h=Matrix.from(r.col(c)).T,_=new Matrix(o,1,(function(){return a.random})),d=h.sub(t.dot(_)),v=d.clone();do{var y=t.dot(v),m=d.T.dot(d).entry(0,0)/v.T.dot(y).entry(0,0);_=_.add(v.mult(m));var g=d.sub(y.mult(m)),w=g.T.dot(g).entry(0,0)/d.T.dot(d).entry(0,0);v=g.add(v.mult(w)),d=g}while(Math.abs(d.mean)>i);l=l.concat(_,"horizontal")}return l}},{key:"solve",value:function solve(t,r){for(var a=("L"in t&&"U"in t?t:Matrix.LU(t)),i=a.L,o=a.U,u=i.shape[0],l=r.clone(),c=0;c<u;++c){for(var h=0;h<c-1;++h)l.set_entry(0,c,l.entry(0,c)-i.entry(c,h)*l.entry(1,h));l.set_entry(0,c,l.entry(0,c)/i.entry(c,c))}for(var _=u-1;_>=0;--_){for(var d=u-1;d>_;--d)l.set_entry(0,_,l.entry(0,_)-o.entry(_,d)*l.entry(0,d));l.set_entry(0,_,l.entry(0,_)/o.entry(_,_))}return l}},{key:"LU",value:function LU(t){for(var r=t.shape[0],a=new Matrix(r,r,"zeros"),i=new Matrix(r,r,"identity"),o=0;o<r;++o){for(var u=o;u<r;++u){for(var l=0,c=0;c<o;++c)l+=a.entry(u,c)*i.entry(c,o);a.set_entry(u,o,t.entry(u,o)-l)}for(var h=o;h<r;++h){if(0===a.entry(o,o))return;for(var _=0,d=0;d<o;++d)_+=a.entry(o,d)*i.entry(d,h);i.set_entry(o,h,(t.entry(o,h)-_)/a.entry(o,o))}}return{L:a,U:i}}},{key:"SVD",value:function SVD(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=t.T,i=a.dot(t),o=t.dot(a),u=simultaneous_poweriteration(i,r),l=u.eigenvectors,c=u.eigenvalues,h=simultaneous_poweriteration(o,r),_=h.eigenvectors;return{U:_,Sigma:c.map((function(t){return Math.sqrt(t)})),V:l}}}]),Matrix}();function distance_matrix(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:euclidean,a=t.shape[0],i=new O(a,a),o=0;o<a;++o)for(var u=t.row(o),l=o+1;l<a;++l){var c=r(u,t.row(l));i.set_entry(o,l,c),i.set_entry(l,o,c)}return i}function linspace(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(a||(a=Math.max(Math.round(r-t)+1,1)),a<2)return 1===a?[t]:[];for(var i=new Array(a),o=a-=1;o>=0;--o)i[o]=(o*r+(a-o)*t)/a;return i}function norm(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:euclidean,a=null;if(t instanceof O){var i=w.default(t.shape,2),o=i[0],u=i[1];if(1===o)a=t.row(0);else{if(1!==u)throw"matrix must be 1d!";a=t.col(0)}}else a=t;var l=a.length,c=new Array(l);return c.fill(0),r(a,c)}var z=function(){function Randomizer(t){return b.default(this,Randomizer),this._N=624,this._M=397,this._MATRIX_A=2567483615,this._UPPER_MASK=2147483648,this._LOWER_MASK=2147483647,this._mt=new Array(this._N),this._mti=this.N+1,this.seed=t||(new Date).getTime(),this}return k.default(Randomizer,[{key:"seed",get:function get(){return this._seed},set:function set(t){this._seed=t;var r=this._mt;for(r[0]=t>>>0,this._mti=1;this._mti<this._N;this._mti+=1){var a=this._mti,i=r[a-1]^r[a-1]>>>30;r[a]=(1812433253*((4294901760&i)>>>16)<<16)+1812433253*(65535&i)+a,r[a]>>>=0}}},{key:"random",get:function get(){return this.random_int*(1/4294967296)}},{key:"random_int",get:function get(){var t,r=new Array(0,this._MATRIX_A);if(this._mti>=this._N){var a;this._mti==this._N+1&&(this.seed=5489);var i=this._N-this._M,o=this._M-this._N;for(a=0;a<i;++a)t=this._mt[a]&this._UPPER_MASK|this._mt[a+1]&this._LOWER_MASK,this._mt[a]=this._mt[a+this._M]^t>>>1^r[1&t];for(;a<this._N-1;++a)t=this._mt[a]&this._UPPER_MASK|this._mt[a+1]&this._LOWER_MASK,this._mt[a]=this._mt[a+o]^t>>>1^r[1&t];t=this._mt[this._N-1]&this._UPPER_MASK|this._mt[0]&this._LOWER_MASK,this._mt[this._N-1]=this._mt[this._M-1]^t>>>1^r[1&t],this._mti=0}return t=this._mt[this._mti+=1],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0}},{key:"choice",value:function choice(t,r){if(t instanceof O){var a=w.default(t.shape,2),i=a[0];if(a[1],r>i)throw"n bigger than A!";for(var o=new Array(r),u=linspace(0,i-1),l=0,c=u.length;l<r;++l,--c){var h=this.random_int%c;o[l]=u.splice(h,1)[0]}return o.map((function(r){return t.row(r)}))}if(Array.isArray(t)||t instanceof Float64Array){var _=t.length;if(r>_)throw"n bigger than A!";for(var d=new Array(r),v=linspace(0,_-1),y=0,m=v.length;y<r;++y,--m){var g=this.random_int%m;d[y]=v.splice(g,1)[0]}return d.map((function(r){return t[r]}))}}}],[{key:"choice",value:function choice(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:19870307,i=w.default(t.shape,2),o=i[0];if(i[1],r>o)throw"n bigger than A!";for(var u=new Randomizer(a),l=new Array(r),c=linspace(0,o-1),h=0,_=c.length;h<r;++h,--_){var d=u.random_int%_;l[h]=c.splice(d,1)[0]}return l.map((function(r){return t.row(r)}))}}]),Randomizer}();function _createForOfIteratorHelper$6(t,r){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function _unsupportedIterableToArray$6(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$6(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray$6(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var i=0,o=function F(){};return{s:o,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){a=t[Symbol.iterator]()},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==a.return||a.return()}finally{if(c)throw u}}}}function _arrayLikeToArray$6(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=t[a];return i}function max(t){var r,a,i=_createForOfIteratorHelper$6(t);try{for(i.s();!(a=i.n()).done;){var o=a.value;null!=o&&(r<o||void 0===r&&o>=o)&&(r=o)}}catch(t){i.e(t)}finally{i.f()}return r}function _createForOfIteratorHelper$5(t,r){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function _unsupportedIterableToArray$5(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$5(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray$5(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var i=0,o=function F(){};return{s:o,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){a=t[Symbol.iterator]()},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==a.return||a.return()}finally{if(c)throw u}}}}function _arrayLikeToArray$5(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=t[a];return i}var N=function(){function Heap(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"min";return b.default(this,Heap),t?Heap.heapify(t,r,a):(this._accessor=r,this._container=[],this._comparator="min"==a?function(t,r){return t<r}:"max"==a?function(t,r){return t>r}:a,this)}return k.default(Heap,[{key:"_swap",value:function _swap(t,r){var a=this._container,i=[a[t],a[r]];a[r]=i[0],a[t]=i[1]}},{key:"_heapify_up",value:function _heapify_up(){for(var t=this._container,r=t.length-1;r>0;){var a=Math.floor((r-1)/2);if(!this._comparator(t[r].value,t[a].value))break;this._swap(a,r),r=a}}},{key:"push",value:function push(t){var r={element:t,value:this._accessor(t)};return this._container.push(r),this._heapify_up(),this}},{key:"_heapify_down",value:function _heapify_down(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=this._container,a=this._comparator,i=r.length,o=2*t+1,u=2*t+2,l=t;if(l>i)throw"index higher than length";o<i&&a(r[o].value,r[l].value)&&(l=o),u<i&&a(r[u].value,r[l].value)&&(l=u),l!==t&&(this._swap(t,l),this._heapify_down(l))}},{key:"pop",value:function pop(){var t=this._container;if(0===t.length)return null;if(1===t.length)return t.pop();this._swap(0,t.length-1);var r=t.pop();return this._heapify_down(),r}},{key:"first",get:function get(){return this._container.length>0?this._container[0]:null}},{key:"iterate",value:M.default.mark((function iterate(){var t,r;return M.default.wrap((function iterate$(a){for(;;)switch(a.prev=a.next){case 0:t=0,r=this._container.length;case 1:if(!(t<r)){a.next=7;break}return a.next=4,this._container[t].element;case 4:++t,a.next=1;break;case 7:case"end":return a.stop()}}),iterate,this)}))},{key:"toArray",value:function toArray(){var t=this;return this.data().sort((function(r,a){return t._comparator(r,a)?-1:0}))}},{key:"data",value:function data(){return this._container.map((function(t){return t.element}))}},{key:"raw_data",value:function raw_data(){return this._container}},{key:"length",get:function get(){return this._container.length}},{key:"empty",get:function get(){return 0===this.length}}],[{key:"heapify",value:function heapify(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"min",o=new Heap(null,a,i),u=o._container,l=_createForOfIteratorHelper$5(t);try{for(l.s();!(r=l.n()).done;){var c=r.value;u.push({element:c,value:a(c)})}}catch(t){l.e(t)}finally{l.f()}for(var h=Math.floor(t.length/2-1);h>=0;--h)o._heapify_down(h);return o}}]),Heap}();function _createForOfIteratorHelper$4(t,r){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function _unsupportedIterableToArray$4(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$4(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray$4(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var i=0,o=function F(){};return{s:o,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){a=t[Symbol.iterator]()},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==a.return||a.return()}finally{if(c)throw u}}}}function _arrayLikeToArray$4(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=t[a];return i}var P=function(){function DisjointSet(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(b.default(this,DisjointSet),this._list=new Set,t){var r,a=_createForOfIteratorHelper$4(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.make_set(i)}}catch(t){a.e(t)}finally{a.f()}}return this}return k.default(DisjointSet,[{key:"make_set",value:function make_set(t){var r=this._list;return r.has(t)||(r.add(t),t.__disjoint_set={},t.__disjoint_set.parent=t,t.__disjoint_set.children=new Set([t]),t.__disjoint_set.size=1),this}},{key:"find",value:function find(t){var r;return this._list.has(t)?t.__disjoint_set.parent!==t?((r=t.__disjoint_set.children).add.apply(r,A.default(t)),t.__disjoint_set.parent=this.find(t.__disjoint_set.parent),t.__disjoint_set.parent):t:null}},{key:"union",value:function union(t,r){var a=this.find(t),i=this.find(r);if(a===i)return this;if(a.__disjoint_set.size<i.__disjoint_set.size){var o=[i,a];a=o[0],i=o[1]}return i.__disjoint_set.parent=a,i.__disjoint_set.children.forEach(a.__disjoint_set.children.add,a.__disjoint_set.children),a.__disjoint_set.size+=i.__disjoint_set.size,this}}]),DisjointSet}(),C=function(){function BallTree(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:euclidean;return b.default(this,BallTree),this._Node=function(){return function _class(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;b.default(this,_class),this.pivot=t,this.child1=r,this.child2=a,this.radius=i}}(),this._Leaf=function(){return function _class2(t){b.default(this,_class2),this.points=t}}(),this._metric=r,t&&this.add(t),this}return k.default(BallTree,[{key:"add",value:function add(t){return t=t.map((function(t,r){return{index:r,element:t}})),this._root=this._construct(t),this}},{key:"_construct",value:function _construct(t){var r=this;if(1===t.length)return new this._Leaf(t);var a=this._greatest_spread(t),i=t.sort((function(t,r){return t.element[a]-r.element[a]})),o=i.length,u=Math.floor(o/2),l=t[u],c=i.slice(0,u),h=i.slice(u,o),_=Math.max.apply(Math,A.default(t.map((function(t){return r._metric(l.element,t.element)}))));return c.length>0&&h.length>0?new this._Node(l,this._construct(c),this._construct(h),_):new this._Leaf(t)}},{key:"_greatest_spread",value:function _greatest_spread(t){for(var r=t[0].element.length,a=new Array(r),i=0;i<r;++i)a[i]=[1/0,-1/0];var o=t.reduce((function(t,a){for(var i=0;i<r;++i)t[i][0]=Math.min(t[i][0],a.element[i]),t[i][1]=Math.max(t[i][1],a.element[i]);return t}),a);o=o.map((function(t){return t[1]-t[0]}));for(var u=0,l=0;l<r;++l)u=o[l]>o[u]?l:u;return u}},{key:"search",value:function search(t){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return this._search(t,a,new N(null,(function(a){return r._metric(a.element,t)}),"max"),this._root)}},{key:"_search",value:function _search(t,r,a,i){if(a.length>=r&&i.pivot&&i.radius&&this._metric(t,i.pivot.element)-i.radius>=a.first.value)return a;if(i.child1&&this._search(t,r,a,i.child1),i.child2&&this._search(t,r,a,i.child2),i.points)for(var o=0,u=i.points.length;o<u;++o){var l=i.points[o];r>a.length?a.push(l):(a.push(l),a.pop())}return a}}]),BallTree}();function qr(t){for(var r=w.default(t.shape,2),a=r[0],i=r[1],o=new O(a,i,"identity"),u=new O(i,i,0),l=function _loop(r){for(var i=t.col(r),l=function _loop2(t){var a=o.col(t),l=neumair_sum(a.map((function(t,r){return t*i[r]})));u.set_entry(t,r,l),i=i.map((function(t,r){return t-l*a[r]}))},c=0;c<r;++c)l(c);for(var h=norm(i,euclidean),_=0;_<a;++_)o.set_entry(_,r,i[_]/h);u.set_entry(r,r,h)},c=0;c<i;++c)l(c);return{R:u,Q:o}}function simultaneous_poweriteration$1(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212,o=i instanceof z?i:new z(i);t instanceof O||(t=O.from(t));for(var u=t.shape[0],l=qr(new O(u,r,(function(){return o.random}))),c=l.Q,h=l.R;a--;){var _=h.clone(),d=t.dot(c),v=qr(d);c=v.Q,neumair_sum((h=v.R).sub(_).diag)/u<1e-12&&(a=0)}var y=h.diag,m=c.transpose().to2dArray;return{eigenvalues:y,eigenvectors:m}}function _createForOfIteratorHelper$3(t,r){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function _unsupportedIterableToArray$3(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$3(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray$3(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var i=0,o=function F(){};return{s:o,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){a=t[Symbol.iterator]()},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==a.return||a.return()}finally{if(c)throw u}}}}function _arrayLikeToArray$3(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=t[a];return i}var D=function(){function DR(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:euclidean,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212;if(b.default(this,DR),Array.isArray(t))this._type="array",this.X=O.from(t);else{if(!(t instanceof O))throw"no valid type for X";this._type="matrix",this.X=t}var o=w.default(this.X.shape,2);return this._N=o[0],this._D=o[1],this._d=r,this._metric=a,this._seed=i,this._randomizer=new z(i),this._is_initialized=!1,this}var t,r;return k.default(DR,[{key:"parameter_list",get:function get(){return this._parameter_list},set:function set(t){return this._parameter_list=t,this}},{key:"parameter",value:function parameter(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(-1===this.parameter_list.findIndex((function(r){return r===t})))throw"".concat(t," is not a valid parameter!");return r?(this["_".concat(t)]=r,this):this["_".concat(t)]}},{key:"para",value:function para(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.parameter(t,r)}},{key:"p",value:function p(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.parameter(t,r)}},{key:"transform",value:function transform(){return this.check_init(),this.Y}},{key:"generator",value:function generator(){return this.transform()}},{key:"check_init",value:function check_init(){this._is_initialized||"function"!=typeof this.init||(this.init(),this._is_initialized=!0)}},{key:"projection",get:function get(){return"matrix"===this._type?this.Y:this.Y.to2dArray}},{key:"transform_async",value:(r=L.default(M.default.mark((function _callee(){return M.default.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.transform());case 1:case"end":return t.stop()}}),_callee,this)}))),function transform_async(){return r.apply(this,arguments)})}],[{key:"transform",value:function transform(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=R.default(this,r);return i.transform()}},{key:"transform_async",value:(t=L.default(M.default.mark((function _callee2(){var t=arguments;return M.default.wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.transform.apply(this,t));case 1:case"end":return r.stop()}}),_callee2,this)}))),function transform_async(){return t.apply(this,arguments)})},{key:"generator",value:M.default.mark((function generator(){var t,r,a,i,o,u,l,c,h=arguments;return M.default.wrap((function generator$(_){for(;;)switch(_.prev=_.next){case 0:for(t=h.length,r=new Array(t),a=0;a<t;a++)r[a]=h[a];i=R.default(this,r),o=i.generator(),u=_createForOfIteratorHelper$3(o),_.prev=4,u.s();case 6:if((l=u.n()).done){_.next=12;break}return c=l.value,_.next=10,c;case 10:_.next=6;break;case 12:_.next=17;break;case 14:_.prev=14,_.t0=_.catch(4),u.e(_.t0);case 17:return _.prev=17,u.f(),_.finish(17);case 20:case"end":return _.stop()}}),generator,this,[[4,14,17,20]])}))}]),DR}();function _createSuper$c(t){var r=function _isNativeReflectConstruct$c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var E=function(t){S.default(PCA,t);var r=_createSuper$c(PCA);function PCA(t){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return b.default(this,PCA),a=r.call(this,t,i),T.default(a,x.default(a))}return k.default(PCA,[{key:"transform",value:function transform(){var t=this.X,r=t.shape[1],a=new O(r,r,"center"),i=t.dot(a),o=simultaneous_poweriteration$1(i.transpose().dot(i),this._d).eigenvectors;return o=O.from(o).transpose(),this.Y=t.dot(o),this.projection}}]),PCA}(D);function _createSuper$b(t){var r=function _isNativeReflectConstruct$b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var B=function(t){S.default(MDS,t);var r=_createSuper$b(MDS);function MDS(t){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:euclidean,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212;return b.default(this,MDS),a=r.call(this,t,i,o,u),T.default(a,x.default(a))}return k.default(MDS,[{key:"transform",value:function transform(){var t=this.X,r=t.shape[0],a=this._metric,i="precomputed"===a?t:distance_matrix(t,a),o=i.meanCols,u=i.meanRows,l=i.mean;this._d_X=i;var c=simultaneous_poweriteration$1(new O(r,r,(function(t,r){return i.entry(t,r)-o[t]-u[r]+l})),this._d).eigenvectors;return this.Y=O.from(c).transpose(),this.projection}},{key:"stress",get:function get(){var t=this.X.shape[0],r=this.Y,a=this._d_X,i=new O;i.shape=[t,t,function(t,a){return t<a?euclidean(r.row(t),r.row(a)):i.entry(a,t)}];for(var o=0,u=0,l=0;l<t;++l)for(var c=l+1;c<t;++c)o+=Math.pow(a.entry(l,c)-i.entry(l,c),2),u+=Math.pow(a.entry(l,c),2);return Math.sqrt(o/u)}}]),MDS}(D);function _createSuper$a(t){var r=function _isNativeReflectConstruct$a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var q=function(t){S.default(ISOMAP,t);var r=_createSuper$a(ISOMAP);function ISOMAP(t,a){var i,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:euclidean,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;return b.default(this,ISOMAP),o=r.call(this,t,u,l,c),I.default((i=x.default(o),$.default(ISOMAP.prototype)),"parameter_list",["k"],i,!0),o.parameter("k",Math.min(null!=a?a:Math.max(Math.floor(o.X.shape[0]/10),2),o._N-1)),T.default(o,x.default(o))}return k.default(ISOMAP,[{key:"transform",value:function transform(){this.check_init();var t=this.X,r=this._N,a=this._metric,i=new O;i.shape=[r,r,function(r,o){return r<=o?a(t.row(r),t.row(o)):i.entry(o,r)}];for(var o=[],u=0;u<r;++u){for(var l=[],c=0;c<r;++c)l.push({index:c,distance:i.entry(u,c)});var h=new N(l,(function(t){return t.distance}),"min");o.push(h.toArray().slice(1,this._k+1))}for(var _=new O(r,r,(function(t,r){var a=o[t].find((function(t){return t.index===r}));return a?a.distance:1/0})),d=0;d<r;++d)for(var v=0;v<r;++v)for(var y=0;y<r;++y)_.set_entry(d,v,Math.min(_.entry(d,v),_.entry(d,y)+_.entry(y,v)));var m=new Float64Array(r),g=new Float64Array(r),w=0,b=new O(r,r,(function(t,r){var a=_.entry(t,r);return a=a===1/0?0:a,m[t]+=a,g[r]+=a,w+=a,a}));m=m.map((function(t){return t/r})),g=g.map((function(t){return t/r})),w/=Math.pow(r,2);var k=simultaneous_poweriteration$1(new O(r,r,(function(t,r){return b.entry(t,r)-m[t]-g[r]+w})),this._d).eigenvectors;return this.Y=O.from(k).transpose(),this.projection}}]),ISOMAP}(D);function _createSuper$9(t){var r=function _isNativeReflectConstruct$9(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var X=function(t){S.default(FASTMAP,t);var r=_createSuper$9(FASTMAP);function FASTMAP(t){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:euclidean,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212;return b.default(this,FASTMAP),a=r.call(this,t,i,o,u),T.default(a,x.default(a))}return k.default(FASTMAP,[{key:"_choose_distant_objects",value:function _choose_distant_objects(t){for(var r=this.X.shape[0],a=this._randomizer.random_int%r-1,i=null,o=-1/0,u=0;u<r;++u){var l=t(a,u);l>o&&(o=l,i=u)}o=-1/0;for(var c=0;c<r;++c){var h=t(i,c);h>o&&(o=h,a=c)}return[a,i,o]}},{key:"transform",value:function transform(){for(var t=this,r=this.X,a=r.shape[0],i=this._d,o=this._metric,u=new O(a,i,0),l=function dist(t,a){return o(r.row(t),r.row(a))},c=function _loop(r){var i=l,o=t._choose_distant_objects(l),c=w.default(o,3),h=c[0],_=c[1],d=c[2];if(0!==d){for(var v=0;v<a;++v){var y=l(h,v),m=l(_,v),g=(Math.pow(y,2)+Math.pow(d,2)-Math.pow(m,2))/(2*d);u.set_entry(v,r,g)}l=function dist(t,a){return Math.sqrt(Math.pow(i(t,a),2)-Math.pow(u.entry(t,r)-u.entry(a,r),2))}}},h=0;h<i;++h)c(h);return this.Y=u,this.projection}}]),FASTMAP}(D);function _createSuper$8(t){var r=function _isNativeReflectConstruct$8(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var H=function(t){S.default(LDA,t);var r=_createSuper$8(LDA);function LDA(t,a){var i,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:euclidean,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;return b.default(this,LDA),o=r.call(this,t,u,l,c),I.default((i=x.default(o),$.default(LDA.prototype)),"parameter_list",["labels"],i,!0),o.parameter("labels",a),T.default(o,x.default(o))}return k.default(LDA,[{key:"transform",value:function transform(){var t=this.X,r=w.default(t.shape,2);r[0];var a=r[1],i=this._labels,o={},u=0;i.forEach((function(r,a){r in o?(o[r].count++,o[r].rows.push(t.row(a))):o[r]={id:u++,count:1,rows:[t.row(a)]}}));var l=t.mean,c=new O(u,a);for(var h in o)for(var _=O.from(o[h].rows).meanCols,d=0;d<a;++d)c.set_entry(o[h].id,d,_[d]);var v=new O(a,a),y=function _loop(t){var r=c.row(o[t].id),i=new O(a,1,(function(t){return r[t]-l})),u=o[t].count;v=v.add(i.dot(i.transpose()).mult(u))};for(var m in o)y(m);var g=new O(a,a),b=function _loop2(t){for(var r=c.row(o[t].id),i=new O(a,1,(function(t){return r[t]})),u=o[t].rows,l=function _loop3(t,r){var o=new O(a,1,(function(r,a){return u[t][r]-i.entry(r,0)}));g=g.add(o.dot(o.transpose()))},h=0,_=o[t].count;h<_;++h)l(h)};for(var k in o)b(k);var A=simultaneous_poweriteration$1(g.inverse().dot(v),this._d).eigenvectors;return A=O.from(A).transpose(),this.Y=t.dot(A),this.projection}}]),LDA}(D);function _createSuper$7(t){var r=function _isNativeReflectConstruct$7(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var Y=function(t){S.default(LLE,t);var r=_createSuper$7(LLE);function LLE(t,a){var i,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:euclidean,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;return b.default(this,LLE),o=r.call(this,t,u,l,c),I.default((i=x.default(o),$.default(LLE.prototype)),"parameter_list",["k"],i,!0),o.parameter("k",Math.min(null!=a?a:Math.max(Math.floor(o._N/10),2),o._N-1)),T.default(o,x.default(o))}return k.default(LLE,[{key:"transform",value:function transform(){for(var t=this,r=this.X,a=this._d,i=this._N,o=this._D,u=this.parameter("k"),l=k_nearest_neighbors(r,u,null,this._metric),c=new O(u,1,1),h=new O(i,i),_=function _loop(a){var i=l[a],_=new O(u,o,(function(t,o){return r.entry(i[t].j,o)-r.entry(a,o)})),d=_.dot(_.T);if(u>o)for(var v=neumair_sum(d.diag)/1e3,y=0;y<u;++y)d.set_entry(y,y,d.entry(y,y)+v);var m=O.solve_CG(d,c,t._randomizer);m=m.divide(m.sum);for(var g=0;g<u;++g)h.set_entry(a,i[g].j,m.entry(g,0))},d=0;d<i;++d)_(d);var v=new O(i,i,"identity").sub(h),y=simultaneous_poweriteration$1(v.T.dot(v).T.inverse(),a+1).eigenvectors;return this.Y=O.from(y.slice(1,1+a)).T,this.projection}}]),LLE}(D);function _createSuper$6(t){var r=function _isNativeReflectConstruct$6(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var U=function(t){S.default(LTSA,t);var r=_createSuper$6(LTSA);function LTSA(t,a){var i,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:euclidean,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;if(b.default(this,LTSA),o=r.call(this,t,u,l,c),I.default((i=x.default(o),$.default(LTSA.prototype)),"parameter_list",["k"],i,!0),o.parameter("k",Math.min(null!=a?a:Math.max(Math.floor(o._N/10),2),o._N-1)),o._D<=u)throw"Dimensionality of X (D = ".concat(o._D,") must be greater than the required dimensionality of the result (d = ").concat(u,")!");return T.default(o,x.default(o))}return k.default(LTSA,[{key:"transform",value:function transform(){for(var t=this.X,r=this._d,a=w.default(t.shape,2),i=a[0],o=a[1],u=this.parameter("k"),l=k_nearest_neighbors(t,u,null,this._metric),c=new O(o,o,"center"),h=new O(i,i,0),_=0;_<i;++_)for(var d=[_].concat(A.default(l[_].map((function(t){return t.j})))),v=O.from(d.map((function(r){return t.row(r)}))),y=simultaneous_poweriteration$1((v=v.dot(c)).dot(v.transpose()),r).eigenvectors,m=O.from(y),g=m.transpose().dot(m).add(1/Math.sqrt(u+1)),b=0;b<u+1;++b)for(var k=0;k<u+1;++k)h.set_entry(d[b],d[k],h.entry(d[b],d[k])-(b===k?1:0)+g.entry(b,k));var M=simultaneous_poweriteration$1(h,r+1).eigenvectors;return this.Y=O.from(M.slice(1)).transpose(),this.projection}}]),LTSA}(D);function _createSuper$5(t){var r=function _isNativeReflectConstruct$5(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var K=function(t){S.default(TSNE,t);var r=_createSuper$5(TSNE);function TSNE(t){var a,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:euclidean,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1212;b.default(this,TSNE),i=r.call(this,t,l,c,h),I.default((a=x.default(i),$.default(TSNE.prototype)),"parameter_list",["perplexity","epsilon"],a,!0);var _=w.default(i.X.shape,2);return i._N=_[0],i._D=_[1],i.parameter("perplexity",Math.min(o,i._N-1)),i.parameter("epsilon",u),i._iter=0,i.Y=new O(i._N,i._d,(function(){return i._randomizer.random})),T.default(i,x.default(i))}return k.default(TSNE,[{key:"init",value:function init(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=Math.log(this._perplexity),i=this._N,o=this._D,u=this._metric,l=this.X;if(r)t=r;else{t=new O(i,i);for(var c=0;c<i;++c)for(var h=l.row(c),_=c+1;_<i;++_){var d=u(h,l.row(_));t.set_entry(c,_,d),t.set_entry(_,c,d)}}var v=new O(i,i,"zeros");this._ystep=new O(i,o,"zeros"),this._gains=new O(i,o,1);for(var y=new Array(i).fill(0),m=1e-4,g=50,w=0;w<i;++w){for(var b=-1/0,k=1/0,A=1,M=!1,x=0;!M;){for(var S=0,T=0;T<i;++T){var $=Math.exp(-t.entry(w,T)*A);w===T&&($=0),y[T]=$,S+=$}for(var R=0,L=0;L<i;++L){var I=0===S?0:y[L]/S;y[L]=I,I>1e-7&&(R-=I*Math.log(I))}R>a?(b=A,A=k===1/0?2*A:(A+k)/2):(k=A,A=b===-1/0?A/2:(A+b)/2),++x,Math.abs(R-a)<m&&(M=!0),x>=g&&(M=!0)}for(var j=0;j<i;++j)v.set_entry(w,j,y[j])}for(var z=new O(i,i,"zeros"),N=2*i,P=0;P<i;++P)for(var C=P;C<i;++C){var D=Math.max((v.entry(P,C)+v.entry(C,P))/N,1e-100);z.set_entry(P,C,D),z.set_entry(C,P,D)}return this._P=z,this}},{key:"transform",value:function transform(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.check_init();for(var r=0;r<t;++r)this.next();return this.projection}},{key:"generator",value:M.default.mark((function generator(){return M.default.wrap((function generator$(t){for(;;)switch(t.prev=t.next){case 0:this.check_init();case 1:return this.next(),t.next=5,this.projection;case 5:t.next=1;break;case 7:case"end":return t.stop()}}),generator,this)}))},{key:"next",value:function next(){for(var t=++this._iter,r=this._P,a=this._ystep,i=this._gains,o=this._N,u=this._epsilon,l=this._d,c=this.Y,h=t<100?4:1,_=new O(o,o,"zeros"),d=0,v=0;v<o;++v)for(var y=v+1;y<o;++y){for(var m=0,g=0;g<l;++g){var w=c.entry(v,g)-c.entry(y,g);m+=w*w}var b=1/(1+m);_.set_entry(v,y,b),_.set_entry(y,v,b),d+=2*b}for(var k=new O(o,o,0),A=0;A<o;++A)for(var M=A+1;M<o;++M){var x=Math.max(_.entry(A,M)/d,1e-100);k.set_entry(A,M,x),k.set_entry(M,A,x)}for(var S=new O(o,l,"zeros"),T=0;T<o;++T)for(var $=0;$<o;++$)for(var R=4*(h*r.entry(T,$)-k.entry(T,$))*_.entry(T,$),L=0;L<l;++L)S.set_entry(T,L,S.entry(T,L)+R*(c.entry(T,L)-c.entry($,L)));for(var I=new Float64Array(l),j=0;j<o;++j)for(var z=0;z<l;++z){var N=S.entry(j,z),P=a.entry(j,z),C=i.entry(j,z),D=Math.sign(N)===Math.sign(P)?.8*C:C+.2;D<.01&&(D=.01),i.set_entry(j,z,D);var E=(t<250?.5:.8)*P-u*D*N;a.set_entry(j,z,E),c.set_entry(j,z,c.entry(j,z)+E),I[z]+=c.entry(j,z)}for(var B=0;B<o;++B)for(var q=0;q<2;++q)c.set_entry(B,q,c.entry(B,q)-I[q]/o);return this.Y}}]),TSNE}(D);function powell(t,r){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,i=.01,o=r.length,u=.001,l=1e4,c=r.slice(),h=t(c),_=!1;a-- >=0&&!_;){_=!0;for(var d=0;d<o;++d){c[d]+=1e-6;var v=t(c);c[d]-=1e-6;var y=(v-h)/1e-6;Math.abs(y)>i&&(_=!1),c[d]-=u*y,h=t(c)}u*=l>=h?1.05:.4,l=h}return c}function _createSuper$4(t){var r=function _isNativeReflectConstruct$4(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var G=function(t){S.default(UMAP,t);var r=_createSuper$4(UMAP);function UMAP(t){var a,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:euclidean,_=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1212;b.default(this,UMAP),i=r.call(this,t,c,h,_),I.default((a=x.default(i),$.default(UMAP.prototype)),"parameter_list",["n_neighbors","local_connectivity","min_dist"],a,!0);var d=w.default(i.X.shape,2);return i._N=d[0],i._D=d[1],o=Math.min(i._N-1,o),i.parameter("n_neighbors",o),i.parameter("local_connectivity",Math.min(u,o-1)),i.parameter("min_dist",l),i._iter=0,i._spread=1,i._set_op_mix_ratio=1,i._repulsion_strength=1,i._negative_sample_rate=5,i._n_epochs=350,i._initial_alpha=1,i.Y=new O(i._N,i._d,(function(){return i._randomizer.random})),T.default(i,x.default(i))}return k.default(UMAP,[{key:"_find_ab_params",value:function _find_ab_params(t,r){for(var a=linspace(0,3*t,300),i=linspace(0,3*t,300),o=0,u=a.length;o<u;++o){var l=a[o];i[o]=l<r?1:Math.exp(-(l-r)/t)}return powell((function err(t){var r=linspace(1,300).map((function(r,o){return i[o]-function curve(t,r,a){return 1/(1+r*Math.pow(t,2*a))}(a[o],t[0],t[1])}));return Math.sqrt(neumair_sum(r.map((function(t){return t*t}))))}),[1,1])}},{key:"_compute_membership_strengths",value:function _compute_membership_strengths(t,r,a){for(var i=0,o=t.length;i<o;++i)for(var u=0,l=t[i].length;u<l;++u){var c=t[i][u].value-a[i];t[i][u].value=c>0?Math.exp(-c/r[i]):1}return t}},{key:"_smooth_knn_dist",value:function _smooth_knn_dist(t,r){for(var a=1e-5,i=.001,o=this._local_connectivity,u=Math.log2(r),l=[],c=[],h=this.X,_=A.default(h).map((function(a){return t.search(a,r).raw_data().reverse()})),d=0,v=h.shape[0];d<v;++d){var y=0,m=1/0,g=1,w=_[d],b=w.filter((function(t){return t.value>0})),k=b.length;if(k>=o){var M=Math.floor(o),x=o-M;M>0?(l.push(b[M-1]),x>a&&(l[d].value+=x*(b[M].value-b[M-1]))):l[d].value=x*b[0].value}else k>0&&(l[d]=b[k-1].value);for(var S=0;S<64;++S){for(var T=0,$=0;$<r;++$){var R=w[$].value-l[d];T+=R>0?Math.exp(-R/g):1}if(Math.abs(T-u)<a)break;if(T>u){var L=[g,(y+m)/2];m=L[0],g=L[1]}else if(m===1/0){var I=[g,2*g];y=I[0],g=I[1]}else{var j=[g,(y+m)/2];y=j[0],g=j[1]}}c[d]=g;var O=w.reduce((function(t,r){return t+r.value}),0)/w.length;if(l[d]>0)c[d]<i*O&&(c[d]=i*O);else{var z=_.reduce((function(t,r){return t+r.reduce((function(t,r){return t+r.value}),0)/r.length}));c[d]>i*z&&(c[d]=i*z)}}return{distances:_,sigmas:c,rhos:l}}},{key:"_fuzzy_simplicial_set",value:function _fuzzy_simplicial_set(t,r){var a=t.shape[0],i=new C(t.to2dArray,euclidean),o=this._smooth_knn_dist(i,r),u=o.distances,l=o.sigmas,c=o.rhos;u=this._compute_membership_strengths(u,l,c);for(var h=new O(a,a,"zeros"),_=0;_<a;++_)for(var d=u[_],v=0;v<d.length;++v)h.set_entry(_,d[v].element.index,d[v].value);var y=h.T,m=h.mult(y);return h.add(y).sub(m).mult(this._set_op_mix_ratio).add(m.mult(1-this._set_op_mix_ratio))}},{key:"_make_epochs_per_sample",value:function _make_epochs_per_sample(t){for(var r=this._weights,a=new Float32Array(r.length).fill(-1),i=max(r),o=r.map((function(r){return t*(r/i)})),u=0;u<a.length;++u)o[u]>0&&(a[u]=Math.round(t/o[u]));return a}},{key:"_tocoo",value:function _tocoo(t){for(var r=[],a=[],i=[],o=w.default(t.shape,2),u=o[0],l=o[1],c=0;c<u;++c)for(var h=0;h<l;++h){var _=t.entry(c,h);0!==_&&(r.push(c),a.push(h),i.push(_))}return{rows:r,cols:a,data:i}}},{key:"init",value:function init(){var t=this,r=this._find_ab_params(this._spread,this._min_dist),a=w.default(r,2),i=a[0],o=a[1];this._a=i,this._b=o,this._graph=this._fuzzy_simplicial_set(this.X,this._n_neighbors);var u=this._tocoo(this._graph),l=u.rows,c=u.cols,h=u.data;return this._head=l,this._tail=c,this._weights=h,this._epochs_per_sample=this._make_epochs_per_sample(this._n_epochs),this._epochs_per_negative_sample=this._epochs_per_sample.map((function(r){return r*t._negative_sample_rate})),this._epoch_of_next_sample=this._epochs_per_sample.slice(),this._epoch_of_next_negative_sample=this._epochs_per_negative_sample.slice(),this}},{key:"local_connectivity",get:function get(){return this._local_connectivity},set:function set(t){this._local_connectivity=t}},{key:"min_dist",get:function get(){return this._min_dist},set:function set(t){this._min_dist=t}},{key:"graph",value:function graph(){return this.check_init(),{cols:this._head,rows:this._tail,weights:this._weights}}},{key:"transform",value:function transform(t){this.check_init(),t=t||this._n_epochs;for(var r=0;r<t;++r)this.next();return this.projection}},{key:"generator",value:M.default.mark((function generator(){return M.default.wrap((function generator$(t){for(;;)switch(t.prev=t.next){case 0:this.check_init(),this._iter=0;case 2:if(!(this._iter<this._n_epochs)){t.next=8;break}return this.next(),t.next=6,this.projection;case 6:t.next=2;break;case 8:return t.abrupt("return",this.projection);case 9:case"end":return t.stop()}}),generator,this)}))},{key:"_clip",value:function _clip(t){return t>4?4:t<-4?-4:t}},{key:"_optimize_layout",value:function _optimize_layout(t,r,a,i){for(var o=this._d,u=this._alpha,l=this._repulsion_strength,c=this._a,h=this._b,_=this._epochs_per_sample,d=this._epochs_per_negative_sample,v=this._epoch_of_next_negative_sample,y=this._epoch_of_next_sample,m=this._clip,g=i.length,w=0,b=_.length;w<b;++w)if(y[w]<=this._iter){var k=a[w],A=i[w],M=t.row(k),x=r.row(A),S="precomputed"===this._metric?this._X.entry(k,A):euclidean_squared(M,x),T=0;S>0&&(T=-2*c*h*Math.pow(S,h-1)/(c*Math.pow(S,h)+1));for(var $=0;$<o;++$){var R=m(T*(M[$]-x[$]))*u,L=M[$]+R,I=x[$]-R;M[$]=L,x[$]=I,t.set_entry(k,$,L),r.set_entry(A,$,I)}y[w]+=_[w];for(var j=(this._iter-v[w])/d[w],O=0;O<j;++O){var z=Math.floor(this._randomizer.random*g),N=r.row(i[z]),P="precomputed"===this._metric?this._X.entry(k,i[z]):euclidean_squared(M,N),C=0;if(P>0)C=2*l*h/((.01+P)*(c*Math.pow(P,h)+1));else if(k===z)continue;for(var D=0;D<o;++D){var E=m(C*(M[D]-N[D]))*u,B=M[D]+E,q=N[D]-E;M[D]=B,N[D]=q,t.set_entry(k,D,B),r.set_entry(i[z],D,q)}}v[w]+=j*d[w]}return t}},{key:"next",value:function next(){var t=++this._iter,r=this.Y;return this._alpha=this._initial_alpha*(1-t/this._n_epochs),this.Y=this._optimize_layout(r,r,this._head,this._tail),this.Y}}]),UMAP}(D);function _createSuper$3(t){var r=function _isNativeReflectConstruct$3(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var W=function(t){S.default(TriMap,t);var r=_createSuper$3(TriMap);function TriMap(t){var a,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:euclidean,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1212;return b.default(this,TriMap),i=r.call(this,t,l,c,h),I.default((a=x.default(i),$.default(TriMap.prototype)),"parameter_list",["weight_adj","c"],a,!0),i.parameter("weight_adj",o),i.parameter("c",u),T.default(i,x.default(i))}return k.default(TriMap,[{key:"init",value:function init(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=this.X,i=a.shape[0],o=this._d,u=this._metric,l=this._c;this.n_inliers=2*l,this.n_outliers=1*l,this.n_random=1*l,this.Y=t||new E(a,o).transform(),this.knn=r||new C(a.to2dArray,u);var c=this._generate_triplets(this.n_inliers,this.n_outliers,this.n_random),h=c.triplets,_=c.weights;return this.triplets=h,this.weights=_,this.lr=1e3*i/h.shape[0],this.C=1/0,this.tol=1e-7,this.vel=new O(i,o,0),this.gain=new O(i,o,1),this}},{key:"_generate_triplets",value:function _generate_triplets(t,r,a){for(var i=this._metric,o=this._weight_adj,u=this.X,l=u.shape[0],c=this.knn,h=Math.min(t+20,l),_=new O(l,h),d=new O(l,h),v=function _loop(t){c.search(u.row(t),h+1).raw_data().filter((function(t){return 0!=t.value})).sort((function(t,r){return t.value-r.value})).forEach((function(r,a){_.set_entry(t,a,r.element.index),d.set_entry(t,a,r.value)}))},y=0;y<l;++y)v(y);for(var m=new Float64Array(l),g=0;g<l;++g)m[g]=Math.max((d.entry(g,3)+d.entry(g,4)+d.entry(g,5)+d.entry(g,6))/4,1e-10);for(var w=this._find_p(d,m,_),b=this._sample_knn_triplets(w,_,t,r),k=b.shape[0],M=new Float64Array(k),x=0;x<k;++x){var S=b.entry(x,0),T=b.entry(x,2);M[x]=i(u.row(S),u.row(T))}var $=this._find_weights(b,w,_,M,m);if(a>0){var R=this._sample_random_triplets(u,a,m),L=R.random_triplets,I=R.random_weights;b=b.concat(L,"vertical"),$=Float64Array.from([].concat(A.default($),A.default(I)))}k=b.shape[0];for(var j=-1/0,z=0;z<k;++z)isNaN($[z])&&($[z]=0),j<$[z]&&(j=$[z]);for(var N=-1/0,P=0;P<k;++P)$[P]/=j,$[P]+=1e-4,$[P]=Math.log(1+o*$[P]),N<$[P]&&(N=$[P]);for(var C=0;C<k;++C)$[C]/=N;return{triplets:b,weights:$}}},{key:"_find_p",value:function _find_p(t,r,a){var i=w.default(t.shape,2),o=i[0],u=i[1];return new O(o,u,(function(i,o){return Math.exp(-Math.pow(t.entry(i,o),2)/r[i]/r[a.entry(i,o)])}))}},{key:"_sample_knn_triplets",value:function _sample_knn_triplets(t,r,a,i){for(var o=r.shape[0],u=new O(o*a*i,3),l=0;l<o;++l)for(var c=l*a*i,h=this.__argsort(t.row(l).map((function(t){return-t}))),_=0;_<a;++_)for(var d=_*i,v=r.entry(l,h[_]),y=this._rejection_sample(i,o,h.slice(0,_+1)),m=0;m<i;++m){var g=c+d+m,w=y[m];u.set_entry(g,0,l),u.set_entry(g,1,v),u.set_entry(g,2,w)}return u}},{key:"__argsort",value:function __argsort(t){return t.map((function(t,r){return{d:t,i:r}})).sort((function(t,r){return t.d-r.d})).map((function(t){return t.i}))}},{key:"_rejection_sample",value:function _rejection_sample(t,r,a){var i=this._randomizer,o=linspace(0,r-1).filter((function(t){return a.indexOf(t)<0}));return i.choice(o,Math.min(t,o.length-2))}},{key:"_find_weights",value:function _find_weights(t,r,a,i,o){for(var u=t.shape[0],l=new Float64Array(u),c=0;c<u;++c){var h=t.entry(c,0),_=a.row(h).indexOf(t.entry(c,1)),d=r.entry(h,_),v=Math.exp(-Math.pow(i[c],2)/(o[h]*o[t.entry(c,2)]));v<1e-20&&(v=1e-20),l[c]=d/v}return l}},{key:"_sample_random_triplets",value:function _sample_random_triplets(t,r,a){for(var i=this._metric,o=this._randomizer,u=t.shape[0],l=new O(u*r,3),c=new Float64Array(u*r),h=0;h<u;++h)for(var _=h*r,d=[].concat(A.default(linspace(0,h-1)),A.default(linspace(h+1,u-1))),v=0;v<r;++v){var y=o.choice(d,2),m=w.default(y,2),g=m[0],b=m[1],k=Math.exp(-Math.pow(i(t.row(h),t.row(g)),2)/(a[h]*a[g]));k<1e-20&&(k=1e-20);var M=Math.exp(-Math.pow(i(t.row(h),t.row(b)),2)/(a[h]*a[b]));if(M<1e-20&&(M=1e-20),k<M){var x=[b,g];g=x[0],b=x[1];var S=[M,k];k=S[0],M=S[1]}var T=_+v;l.set_entry(T,0,h),l.set_entry(T,1,g),l.set_entry(T,2,b),c[T]=k/M}return{random_triplets:l,random_weights:c}}},{key:"_grad",value:function _grad(t){for(var r=this.n_inliers,a=this.n_outliers,i=this.triplets,o=this.weights,u=w.default(t.shape,2),l=u[0],c=u[1],h=i.shape[0],_=new O(l,c,0),d=new Array(c).fill(0),v=new Array(c).fill(0),y=1,m=1,g=0,b=0,k=l*r*a,A=0;A<h;++A){var M=i.row(A),x=w.default(M,3),S=x[0],T=x[1],$=x[2];if(A%a==0||A>=k){y=1,m=1;for(var R=0;R<c;++R){var L=t.entry(S,R),I=t.entry(T,R),j=t.entry($,R);d[R]=L-I,v[R]=L-j,y+=Math.pow(d[R],2),m+=Math.pow(v[R],2)}}else{m=1;for(var z=0;z<c;++z){var N=t.entry(S,z),P=t.entry($,z);v[z]=N-P,m+=Math.pow(v[z],2)}}y>m&&++g,b+=o[A]/(1+m/y);for(var C=Math.pow(o[A]/(y+m),2),D=0;D<c;++D){var E=d[D]*m*C,B=v[D]*y*C;_.set_entry(S,D,_.entry(S,D)+E-B),_.set_entry(T,D,_.entry(T,D)-E),_.set_entry($,D,_.entry($,D)+B)}}return{grad:_,loss:b,n_viol:g}}},{key:"transform",value:function transform(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:400;this.check_init();for(var r=0;r<t;++r)this._next(r);return this.projection}},{key:"generator",value:M.default.mark((function generator(){var t;return M.default.wrap((function generator$(r){for(;;)switch(r.prev=r.next){case 0:this.check_init(),t=0;case 2:if(!(t<800)){r.next=9;break}return this._next(t),r.next=6,this.projection;case 6:++t,r.next=2;break;case 9:return r.abrupt("return",this.projection);case 10:case"end":return r.stop()}}),generator,this)}))},{key:"_next",value:function _next(t){var r=t>150?.5:.3,a=this.C,i=this.vel,o=this.Y.add(i.mult(r)),u=this._grad(o),l=u.grad,c=u.loss;return u.n_viol,this.C=c,this.Y=this._update_embedding(o,t,l),this.lr*=a>c+this.tol?1.01:.9,this.Y}},{key:"_update_embedding",value:function _update_embedding(t,r,a){for(var i=w.default(t.shape,2),o=i[0],u=i[1],l=r>150?.9:.5,c=this.gain,h=this.vel,_=this.lr,d=0;d<o;++d)for(var v=0;v<u;++v){var y=Math.sign(h.entry(d,v))!=Math.sign(a.entry(d,v))?c.entry(d,v)+.2:Math.max(.8*c.entry(d,v),.01);c.set_entry(d,v,y),h.set_entry(d,v,l*h.entry(d,v)-_*c.entry(d,v)*a.entry(d,v)),t.set_entry(d,v,t.entry(d,v)+h.entry(d,v))}return t}}]),TriMap}(D),Q=function(){function Hierarchical_Clustering(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"complete",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:euclidean;if(b.default(this,Hierarchical_Clustering),this._id=0,this._matrix=t instanceof O?t:O.from(t),this._metric=a,this._linkage=r,"precomputed"===a&&t.shape[0]!==t.shape[1])throw"If metric is 'precomputed', then matrix has to be square!";return this.init(),this.root=this.do(),this}return k.default(Hierarchical_Clustering,[{key:"get_clusters",value:function get_clusters(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"distance",i=[];switch(a){case"distance":r=function accessor(t){return t.dist};break;case"depth":r=function accessor(t){return t.depth};break;default:throw"invalid type"}return this._traverse(this.root,r,t,i),i}},{key:"_traverse",value:function _traverse(t,r,a,i){r(t)<=a?i.push(t.leaves()):(this._traverse(t.left,r,a,i),this._traverse(t.right,r,a,i))}},{key:"init",value:function init(){var t,r=this._metric,a=this._matrix,i=this._n=a.shape[0],o=this._d_min=new Float64Array(i);if("precomputed"!==r){t=new O(i,i,0);for(var u=0;u<i;++u){o[u]=0;for(var l=0;l<i;++l)t.set_entry(u,l,u===l?1/0:r(a.row(u),a.row(l))),t.entry(u,o[u])>t.entry(u,l)&&(o[u]=l)}}else{t=this._matrix.clone();for(var c=0;c<i;++c)for(var h=0;h<i;++h)c===h?t.set_entry(c,h,1/0):t.entry(c,o[c])>t.entry(c,h)&&(o[c]=h)}this._distance_matrix=t;for(var _=this._clusters=new Array(i),d=this._c_size=new Uint16Array(i),v=0;v<i;++v)_[v]=[],_[v][0]=new V(this._id++,null,null,0,a.row(v),v,1,0),d[v]=1;return this}},{key:"do",value:function _do(){for(var t=this._n,r=this._d_min,a=this._distance_matrix,i=this._clusters,o=this._c_size,u=this._linkage,l=null,c=0,h=t-1;c<h;++c){for(var _=0,d=0;d<t;++d)a.entry(d,r[d])<a.entry(_,r[_])&&(_=d);var v=r[_],y=i[_][0],m=i[v][0],g=y.isLeaf?[y.index]:y.index,w=m.isLeaf?[m.index]:m.index,b=g.concat(w),k=new V(this._id++,y,m,a.entry(_,v),null,b);y.parent=k,m.parent=k,i[_].unshift(k),o[_]+=o[v];for(var A=0;A<t;++A)switch(u){case"single":a.entry(_,A)>a.entry(v,A)&&(a.set_entry(A,_,a.entry(v,A)),a.set_entry(_,A,a.entry(v,A)));break;case"complete":a.entry(_,A)<a.entry(v,A)&&(a.set_entry(A,_,a.entry(v,A)),a.set_entry(_,A,a.entry(v,A)));break;case"average":var M=(o[_]*a.entry(_,A)+o[v]*a.entry(v,A))/(o[_]+o[A]);a.set_entry(A,_,M),a.set_entry(_,A,M)}a.set_entry(_,_,1/0);for(var x=0;x<t;++x)a.set_entry(x,v,1/0),a.set_entry(v,x,1/0);for(var S=0;S<t;++S)r[S]===v&&(r[S]=_),a.entry(_,S)<a.entry(_,r[_])&&(r[_]=S);l=k}return l}}]),Hierarchical_Clustering}(),V=function(){function Cluster(t,r,a,i,o,u,l,c){return b.default(this,Cluster),this.id=t,this.left=r,this.right=a,this.dist=i,this.index=u,this.size=null!=l?l:r.size+a.size,this.depth=null!=c?c:1+Math.max(r.depth,a.depth),this.centroid=null!=o?o:this._calculate_centroid(r,a),this.parent=null,this}return k.default(Cluster,[{key:"_calculate_centroid",value:function _calculate_centroid(t,r){for(var a=t.size,i=r.size,o=t.centroid,u=r.centroid,l=this.size,c=t.centroid.length,h=new Float64Array(c),_=0;_<c;++_)h[_]=(a*o[_]+i*u[_])/l;return h}},{key:"isLeaf",get:function get(){return 0===this.depth}},{key:"leaves",value:function leaves(){if(this.isLeaf)return[this];var t=this.left,r=this.right;return(t.isLeaf?[t]:t.leaves()).concat(r.isLeaf?[r]:r.leaves())}},{key:"descendants",value:function descendants(){if(this.isLeaf)return[this];var t=this.left.descendants(),r=this.right.descendants();return t.concat(r).concat([this])}}]),Cluster}(),J=function(){function KMeans(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:euclidean,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1987,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];b.default(this,KMeans),this._metric=a,this._matrix=t,this._K=r;var u=w.default(t.shape,2),l=u[0],c=u[1];return this._N=l,this._D=c,r>l&&(r=l),this._randomizer=new z(i),this._clusters=new Array(l).fill(void 0),this._cluster_centroids=this._get_random_centroids(r),o&&this.init(r,this._cluster_centroids),this}return k.default(KMeans,[{key:"get_clusters",value:function get_clusters(){var t=this._K,r=this._clusters,a=new Array(t).fill().map((function(){return new Array}));return r.forEach((function(t,r){return a[t].push(r)})),a}},{key:"_furthest_point",value:function _furthest_point(t,r){var a=this._matrix,i=this._metric,o=t.length;return N.heapify(r,(function(r){for(var u=a.row(r),l=0,c=0;c<o;++c)l+=i(u,t[c]);return l}),"max").pop().element}},{key:"_get_random_centroids",value:function _get_random_centroids(t){var r=this._N,a=this._randomizer,i=this._matrix,o=new Array(t).fill(),u=linspace(0,r-1),l=a.random_int%(r-1);o[0]=i.row(l);for(var c=[l],h=Math.floor((r-t)/t),_=1;_<t;++_){var d=a.choice(u.filter((function(t){return-1==c.indexOf(t)})),h),v=this._furthest_point(o.slice(0,_),d);c.push(v),o[_]=i.row(v)}return o}},{key:"_iteration",value:function _iteration(t){for(var r=t.length,a=this._N,i=this._D,o=this._matrix,u=this._metric,l=this._clusters,c=!1,h=0;h<a;++h){for(var _=o.row(h),d=1/0,v=null,y=0;y<r;++y){var m=u(t[y],_);m<d&&(d=m,v=y)}l[h]!==v&&(c=!0),l[h]=v}for(var g=0;g<r;++g)for(var w=t[g],b=0;b<i;++b)w[b]=0;return this._compute_centroid(t),{clusters_changed:c,cluster_centroids:t}}},{key:"_compute_centroid",value:function _compute_centroid(t){for(var r=t.length,a=this._N,i=this._D,o=this._matrix,u=this._clusters,l=new Array(r).fill(0),c=0;c<a;++c){var h=o.row(c),_=u[c];l[_]++;for(var d=t[_],v=0;v<i;++v)d[v]+=h[v]}for(var y=function _loop(r){var a=l[r];t[r]=t[r].map((function(t){return t/a}))},m=0;m<r;++m)y(m)}},{key:"init",value:function init(t,r){t||(t=this._K),r||(r=this._get_random_centroids(t));var a=!1;do{var i=this._iteration(r);r=i.cluster_centroids,a=i.clusters_changed}while(a)}}]),KMeans}(),Z=function(){function KMedoids(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:euclidean,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;b.default(this,KMedoids),this._metric=i,this._matrix=t,this._A=this._matrix.to2dArray,this._K=r;var u=w.default(t.shape,2),l=u[0],c=u[1];return this._N=l,this._D=c,this._max_iter=a||10*Math.log10(l),this._distance_matrix=new O(l,l,"zeros"),r>l&&(r=l),this._randomizer=new z(o),this._clusters=new Array(l).fill(void 0),this._cluster_medoids=this._get_random_medoids(r),this._is_initialized=!1,this}return k.default(KMedoids,[{key:"get_clusters",value:function get_clusters(){var t=this,r=this._K,a=this._A;this._is_initialized||this.init(r,this._cluster_medoids);var i=new Array(r).fill().map((function(){return new Array}));return a.forEach((function(r,a){i[t._nearest_medoid(r,a).index_nearest].push(a)})),i.medoids=this._cluster_medoids,i}},{key:"generator",value:function generator(){var t=this;return j.default(M.default.mark((function _callee(){var r,a,i;return M.default.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return r=t._max_iter,o.next=3,t.get_clusters();case 3:a=!1,i=0;case 5:return a=t._iteration(),o.next=8,t.get_clusters();case 8:if(!a&&++i<r){o.next=5;break}case 9:case"end":return o.stop()}}),_callee)})))()}},{key:"_iteration",value:function _iteration(){var t=this,r=this._A,a=this._K,i=this._cluster_medoids,o=r.map((function(r,a){return t._nearest_medoid(r,a)})),u=new Array(a).fill(0),l=new Array(a).fill(null);if(r.forEach((function(c,h){if(i.findIndex((function(t){return t===h}))<0){var _=o[h].distance_nearest,d=new Array(a).fill(-_);r.forEach((function(r,i){if(h!==i){var u=t._get_distance(i,h,r,c),l=o[i],_=l.index_nearest,v=l.distance_nearest,y=l.distance_second;if(d[_]+=Math.min(u,y)-v,u<v)for(var m=0;m<a;++m)m!==_&&(d[m]+=u-v)}})),d.map((function(t,r){return[t,r]})).filter((function(t){var r=w.default(t,2),a=r[0],i=r[1];return a<u[i]})).forEach((function(t){var r=w.default(t,2),a=r[0],i=r[1];a<u[i]&&(u[i]=a,l[i]=h)}))}})),Math.min.apply(Math,A.default(u))>=0)return!0;for(var c=function _loop(){var a=u.map((function(t,r){return[t,r]})).sort((function(t,r){return w.default(t,1)[0]-w.default(r,1)[0]}))[0][1];0==i.filter((function(t){return t==l[a]})).length&&(i[a]=l[a]),u[a]=0,u.map((function(t,r){return[t,r]})).filter((function(t){return w.default(t,1)[0]<0})).forEach((function(l){var c=w.default(l,2);c[0];var h=c[1],_=r[h],d=0;r.forEach((function(r,u){i.findIndex((function(t){return t!=h&&t==u}))>=0||a!=h&&(o[u].index_nearest===i[h]?d+=Math.min(t._get_distance(u,h,r,_),o[u].distance_second)-o[u].distance_nearest:d+=Math.min(t._get_distance(u,h,r,_)-o[u].distance_nearest,0))})),u[h]=d}))};Math.min.apply(Math,A.default(u))<0;)c();return this._cluster_medoids=i,!1}},{key:"_get_distance",value:function _get_distance(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t===r)return 0;var o=this._distance_matrix,u=this._A,l=this._metric,c=o.entry(t,r);return 0===c&&(c=l(a||u[t],i||u[r]),o.set_entry(t,r,c),o.set_entry(r,t,c)),c}},{key:"_nearest_medoid",value:function _nearest_medoid(t,r){var a=this,i=this._cluster_medoids,o=this._A,u=i.map((function(i,u){var l=o[i];return[a._get_distance(r,i,t,l),u]})).sort((function(t,r){return t[0]-r[0]})),l=w.default(u,2),c=l[0],h=l[1];return{distance_nearest:c[0],index_nearest:c[1],distance_second:h[0],index_second:h[1]}}},{key:"init",value:function init(t,r){t||(t=this._K),r||(r=this._get_random_medoids(t));var a=this._max_iter,i=!1,o=0;do{i=this._iteration()}while(!i&&++o<a);return this}},{key:"_get_random_medoids",value:function _get_random_medoids(t){for(var r=this,a=this._N,i=this._A,o=linspace(0,a-1),u=this._randomizer,l=Math.min(a,10+Math.ceil(Math.sqrt(a))),c=new Array(l).fill(1/0),h=[],_=1/0,d=u.choice(o,l),v=0;v<l;++v){for(var y=d[v],m=i[y],g=0;g<l;++g)if(g!==v){var w=i[d[g]];c[v]+=this._get_distance(v,g,m,w)}c[v]<_&&(_=c[v],h.push(y))}for(var b=1;b<t;++b){var k=1/0;d=u.choice(o.filter((function(t){return h.findIndex((function(r){return r===t}))<0})),l);for(var M=0;M<l;++M){for(var x=0,S=d[M],T=i[S],$=function _loop2(t){if(t===M)return"continue";var a=d[t],o=i[a],u=r._get_distance(S,a,T,o)-Math.min.apply(Math,A.default(h.map((function(t){return r._get_distance(a,t,o)}))));u<0&&(x+=u)},R=0;R<l;++R)$(R);x<k&&(k=x,h.push(S))}_+=k}return h.slice(0,t)}}]),KMedoids}();function _createForOfIteratorHelper$2(t,r){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function _unsupportedIterableToArray$2(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$2(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray$2(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var i=0,o=function F(){};return{s:o,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){a=t[Symbol.iterator]()},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==a.return||a.return()}finally{if(c)throw u}}}}function _arrayLikeToArray$2(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=t[a];return i}var tt=function(){function OPTICS(t,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:euclidean;return b.default(this,OPTICS),this._matrix=t,this._epsilon=r,this._min_points=a,this._metric=i,this._ordered_list=[],this._clusters=[],this._DB=new Array(t.shape[0]).fill(),this.init(),this}return k.default(OPTICS,[{key:"init",value:function init(){for(var t=this._ordered_list,r=this._matrix,a=r.shape[0],i=this._DB,o=this._clusters,u=this._cluster_index=0,l=0;l<a;++l)i[l]={element:r.row(l),index:l,reachability_distance:void 0,processed:!1};var c,h=_createForOfIteratorHelper$2(i);try{for(h.s();!(c=h.n()).done;){var _=c.value;if(!_.processed&&(_.neighbors=this._get_neighbors(_),_.processed=!0,o.push([_.index]),u=o.length-1,t.push(_),null!=this._core_distance(_))){var d=new N(null,(function(t){return t.reachability_distance}),"min");this._update(_,d),this._expand_cluster(d,o[u])}}}catch(t){h.e(t)}finally{h.f()}return this}},{key:"_get_neighbors",value:function _get_neighbors(t){if("neighbors"in t)return t.neighbors;var r,a=this._DB,i=this._metric,o=this._epsilon,u=[],l=_createForOfIteratorHelper$2(a);try{for(l.s();!(r=l.n()).done;){var c=r.value;c.index!=t.index&&(i(t.element,c.element)<o&&u.push(c))}}catch(t){l.e(t)}finally{l.f()}return u}},{key:"_core_distance",value:function _core_distance(t){var r=this._min_points,a=this._metric;if(!(t.neighbors&&t.neighbors.length<=r))return a(t.element,t.neighbors[r].element)}},{key:"_update",value:function _update(t,r){var a,i=this._metric,o=this._core_distance(t),u=_createForOfIteratorHelper$2(this._get_neighbors(t));try{var l=function _loop(){var u=a.value;if(u.processed)return"continue";var l=Math.max(o,i(t.element,u.element));r.raw_data().findIndex((function(t){return t.element==u}))<0?(u.reachability_distance=l,r.push(u)):l<u.reachability_distance&&(u.reachability_distance=l,r=N.heapify(r.data(),(function(t){return t.reachability_distance}),"min"))};for(u.s();!(a=u.n()).done;)l()}catch(t){u.e(t)}finally{u.f()}}},{key:"_expand_cluster",value:function _expand_cluster(t,r){for(var a=this._ordered_list;!t.empty;){var i=t.pop().element;i.neighbors=this._get_neighbors(i),i.processed=!0,r.push(i.index),a.push(i),null!=this._core_distance(i)&&(this._update(i,t),this._expand_cluster(t,r))}}},{key:"get_clusters",value:function get_clusters(){var t,r=[],a=[],i=this._min_points,o=_createForOfIteratorHelper$2(this._clusters);try{for(o.s();!(t=o.n()).done;){var u=t.value;u.length<i?a.push.apply(a,A.default(u)):r.push(u)}}catch(t){o.e(t)}finally{o.f()}return r.push(a),r}},{key:"get_cluster_affirmation",value:function get_cluster_affirmation(){for(var t=this._matrix.shape[0],r=new Array(t).fill(),a=this.get_clusters(),i=0,o=a.length;i<o;++i){var u,l=_createForOfIteratorHelper$2(a[i]);try{for(l.s();!(u=l.n()).done;){r[u.value]=i<o-1?i:-1}}catch(t){l.e(t)}finally{l.f()}}return r}}]),OPTICS}();function _createForOfIteratorHelper$1(t,r){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function _unsupportedIterableToArray$1(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray$1(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var i=0,o=function F(){};return{s:o,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){a=t[Symbol.iterator]()},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==a.return||a.return()}finally{if(c)throw u}}}}function _arrayLikeToArray$1(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=t[a];return i}function _createSuper$2(t){var r=function _isNativeReflectConstruct$2(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var et=function(t){S.default(LSP,t);var r=_createSuper$2(LSP);function LSP(t,a,i){var o,u,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:euclidean,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1212;return b.default(this,LSP),u=r.call(this,t,l,c,h),I.default((o=x.default(u),$.default(LSP.prototype)),"parameter_list",["k","control_points"],o,!0),u.parameter("k",Math.min(null!=a?a:Math.max(Math.floor(u._N/10),2),u._N-1)),u.parameter("control_points",Math.min(null!=i?i:Math.ceil(Math.sqrt(u._N)),u._N-1)),u._is_initialized=!1,T.default(u,x.default(u))}return k.default(LSP,[{key:"init",value:function init(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C;if(this._is_initialized)return this;var i=this.X,o=this._N,u=this.parameter("k"),l=this._d,c=this._metric,h=this.parameter("control_points"),_=new Z(i,h,null,c).get_clusters().medoids,d=new O(h,o,"zeros");_.forEach((function(t,r){d.set_entry(r,t,1)}));var v=R.default(t,[O.from(_.map((function(t){return i.row(t)})))].concat(A.default(r),[l])).transform(),y=i.to2dArray,m=new a(y,c),g=new O(o,o,"I"),w=-1/u;y.forEach((function(t,r){var a,i=_createForOfIteratorHelper$1(m.search(t,u).iterate());try{for(i.s();!(a=i.n()).done;){var o=a.value.index;r!==o&&g.set_entry(r,o,w)}}catch(t){i.e(t)}finally{i.f()}}));var b=g.concat(d,"vertical"),k=new O(o,l,"zeros"),M=k.concat(v,"vertical");return this._A=b,this._b=M,this._is_initialized=!0,this}},{key:"transform",value:function transform(){this.check_init();var t=this._A,r=t.T,a=this._b,i=r.dot(t),o=r.dot(a);return this.Y=O.solve_CG(i,o,this._randomizer),this.projection}}]),LSP}(D);function _createForOfIteratorHelper(t,r){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var i=0,o=function F(){};return{s:o,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){a=t[Symbol.iterator]()},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==a.return||a.return()}finally{if(c)throw u}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=t[a];return i}function _createSuper$1(t){var r=function _isNativeReflectConstruct$1(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var rt=function(t){S.default(TopoMap,t);var r=_createSuper$1(TopoMap);function TopoMap(t){var a,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:euclidean,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212;b.default(this,TopoMap),i=r.call(this,t,o,u,l),I.default((a=x.default(i),$.default(TopoMap.prototype)),"parameter_list",[],a,!0);var c=w.default(i.X.shape,2);return i._N=c[0],i._D=c[1],i._distance_matrix=new O(i._N,i._N,0),T.default(i,x.default(i))}return k.default(TopoMap,[{key:"__lazy_distance_matrix",value:function __lazy_distance_matrix(t,r,a){var i=this._distance_matrix,o=this.X,u=i.entry(t,r);if(0===u){var l=a(o.row(t),o.row(r));return i.set_entry(t,r,l),i.set_entry(r,t,l),l}return u}},{key:"_make_minimum_spanning_tree",value:function _make_minimum_spanning_tree(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:euclidean,r=this._N,a=A.default(this.X),i=new P(a),o=[],u=[],l=0;l<r;++l)for(var c=l+1;c<r;++c)u.push([l,c,this.__lazy_distance_matrix(l,c,t)]);var h,_=_createForOfIteratorHelper(u=u.sort((function(t,r){return t[2]-r[2]})));try{for(_.s();!(h=_.n()).done;){var d=w.default(h.value,3),v=d[0],y=d[1],m=d[2],g=i.find(a[v]),b=i.find(a[y]);g!==b&&(o.push([v,y,m]),i.union(g,b))}}catch(t){_.e(t)}finally{_.f()}return o.sort((function(t,r){return t[2]-r[2]}))}},{key:"init",value:function init(){return this.Y=new O(this._N,this._d,0),this._Emst=this._make_minimum_spanning_tree(this._metric),this._is_initialized=!0,this}},{key:"__hull_cross",value:function __hull_cross(t,r,a){var i=w.default(t,2),o=i[0],u=i[1],l=w.default(r,2),c=l[0],h=l[1],_=w.default(a,2),d=_[0];return(c-o)*(_[1]-u)-(h-u)*(d-o)<=0}},{key:"__hull",value:function __hull(t){var r=t.sort((function(t,r){var a=w.default(t,2),i=a[0],o=a[1],u=w.default(r,2),l=u[0];return o-u[1]||i-l})),a=r.length;if(a<=2)return r;for(var i=[],o=0;o<a;++o){for(;i.length>=2&&this.__hull_cross(i[i.length-2],i[i.length-1],r[o]);)i.pop();i.push(r[o])}for(var u=[],l=a-1;l>=0;--l){for(;u.length>=2&&this.__hull_cross(u[u.length-2],u[u.length-1],r[l]);)u.pop();u.push(r[l])}return u.pop(),i.pop(),i.concat(u)}},{key:"__findAngle",value:function __findAngle(t,r){var a=w.default(t,2),i=a[0],o=a[1],u=w.default(r,2),l=u[0],c=u[1],h=euclidean([i,o],[l,c]);if(0===h)return{sin:0,cos:1};var _=[(l-i)/h,(c-o)/h],d=_[0],v=Math.sqrt(1-d*d);return{sin:v=_[1]>=0?-v:v,cos:d}}},{key:"__align_hull",value:function __align_hull(t,r,a){for(var i,o,u,l=-1,c=0;c<t.length;++c){var h=euclidean(t[c],r);(-1===l||i>h)&&(i=h,l=c)}a?(o=t[l],u=t[(l+1)%t.length]):(0==l&&(l=t.length-1),o=t[l],u=t[(l-1)%t.length]);var _={tx:-t[l][0],ty:-t[l][1]};if(t.length>=2){var d=this.__findAngle(o,u),v=d.sin,y=d.cos;_.sin=v,_.cos=y}else _.sin=0,_.cos=1;return _}},{key:"__transform",value:function __transform(t,r){var a=w.default(t,2),i=a[0],o=a[1],u=r.tx,l=r.ty,c=r.sin,h=r.cos,_=i+u,d=o+l;return[_*h-d*c,_*c+d*h]}},{key:"__transform_component",value:function __transform_component(t,r,a){for(var i=t.length,o=0;o<i;++o){var u=t[o],l=this.__transform(u,r),c=w.default(l,2),h=c[0],_=c[1];u[0]=h,u[1]=_+a}}},{key:"__align_components",value:function __align_components(t,r,a){var i=A.default(t.__disjoint_set.children),o=A.default(r.__disjoint_set.children),u=this.__hull(i),l=this.__hull(o),c=this.__align_hull(u,t,!1),h=this.__align_hull(l,r,!0);this.__transform_component(i,c,0),this.__transform_component(o,h,a)}},{key:"transform",value:function transform(){this._is_initialized||this.init();var t,r=this._Emst,a=A.default(this.Y),i=new P(a.map((function(t,r){return t.i=r,t}))),o=_createForOfIteratorHelper(r);try{for(o.s();!(t=o.n()).done;){var u=w.default(t.value,3),l=u[0],c=u[1],h=u[2],_=i.find(a[l]),d=i.find(a[c]);_!==d&&(this.__align_components(_,d,h),i.union(_,d))}}catch(t){o.e(t)}finally{o.f()}return this.projection}},{key:"generator",value:M.default.mark((function generator(){var t,r,a,i,o,u,l,c,h,_,d;return M.default.wrap((function generator$(v){for(;;)switch(v.prev=v.next){case 0:this._is_initialized||this.init(),t=this._Emst,r=A.default(this.Y),a=new P(r.map((function(t,r){return t.i=r,t}))),i=_createForOfIteratorHelper(t),v.prev=5,i.s();case 7:if((o=i.n()).done){v.next=19;break}if(u=w.default(o.value,3),l=u[0],c=u[1],h=u[2],_=a.find(r[l]),d=a.find(r[c]),_!==d){v.next=13;break}return v.abrupt("continue",17);case 13:return this.__align_components(_,d,h),a.union(_,d),v.next=17,this.projection;case 17:v.next=7;break;case 19:v.next=24;break;case 21:v.prev=21,v.t0=v.catch(5),i.e(v.t0);case 24:return v.prev=24,i.f(),v.finish(24);case 27:return v.abrupt("return",this.projection);case 28:case"end":return v.stop()}}),generator,this,[[5,21,24,27]])}))}]),TopoMap}(D);function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,i=$.default(t);if(r){var o=$.default(this).constructor;a=Reflect.construct(i,arguments,o)}else a=i.apply(this,arguments);return T.default(this,a)}}var nt=function(t){S.default(SAMMON,t);var r=_createSuper(SAMMON);function SAMMON(t){var a,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:euclidean,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;b.default(this,SAMMON),i=r.call(this,t,u,l,c),I.default((a=x.default(i),$.default(SAMMON.prototype)),"parameter_list",["magic"],a,!0),i.parameter("magic",o);var h=w.default(i.X.shape,2);return i._N=h[0],i._D=h[1],T.default(i,x.default(i))}return k.default(SAMMON,[{key:"init",value:function init(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"random",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=this._N,i=this._d;if("random"===t){var o=this._randomizer;this.Y=new O(a,i,(function(){return o.random}))}else this.Y=t.transform(this.X);return this.Y,this._metric,this.distance_matrix=r||this.__distance_matrix(this.X),this}},{key:"__distance_matrix",value:function __distance_matrix(t){for(var r=this._metric,a=t.shape[0],i=new O(a,a),o=0;o<a;++o)for(var u=t.row(o),l=o;l<a;++l){var c=o===l?0:r(u,t.row(l));i.set_entry(o,l,c),i.set_entry(l,o,c)}return i}},{key:"transform",value:function transform(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this._is_initialized||this.init();for(var r=0;r<t;++r)this._step();return this.projection}},{key:"generator",value:M.default.mark((function generator(){var t,r,a=arguments;return M.default.wrap((function generator$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>0&&void 0!==a[0]?a[0]:200,this._is_initialized||this.init(),r=0;case 3:if(!(r<t)){i.next=10;break}return this._step(),i.next=7,this.projection;case 7:++r,i.next=3;break;case 10:return i.abrupt("return",this.projection);case 11:case"end":return i.stop()}}),generator,this)}))},{key:"_step",value:function _step(){for(var t=this.parameter("magic"),r=this.distance_matrix,a=this._N,i=this._d,o=this._metric,u=this.Y,l=new O(a,i,0),c=new Float64Array(i),h=0;h<a;++h){for(var _=new Float64Array(i),d=new Float64Array(i),v=u.row(h),y=0;y<a;++y)if(h!==y){for(var m=u.row(y),g=new Float64Array(i),w=0;w<i;++w)g[w]=v[w]-m[w];for(var b=o(v,m),k=r.entry(h,y),A=k-b,M=Math.max(k*b,.01),x=0;x<i;++x)_[x]+=g[x]*A/M,d[x]+=(A-Math.pow(g[x],2)*(1+A/b)/b)/M}for(var S=0;S<i;++S){var T=u.entry(h,S)+(t*_[S]/Math.abs(d[S])||0);l.set_entry(h,S,T),c[S]+=T}}for(var $=0;$<i;++$)c[$]/=a;for(var R=0;R<a;++R)for(var L=0;L<i;++L)u.set_entry(R,L,l.entry(R,L)-c[L]);return u}}]),SAMMON}(D);t.BallTree=C,t.DisjointSet=P,t.FASTMAP=X,t.Heap=N,t.Hierarchical_Clustering=Q,t.ISOMAP=q,t.KMeans=J,t.KMedoids=Z,t.LDA=H,t.LLE=Y,t.LSP=et,t.LTSA=U,t.MDS=B,t.Matrix=O,t.OPTICS=tt,t.PCA=E,t.Randomizer=z,t.SAMMON=nt,t.TSNE=K,t.TopoMap=rt,t.TriMap=W,t.UMAP=G,t.canberra=function canberra(t,r){if(t.length===r.length){for(var a=t.length,i=0,o=0;o<a;++o)i+=Math.abs(t[o]-r[o])/(Math.abs(t[o])+Math.abs(r[o]));return i}},t.chebyshev=function chebyshev(t,r){if(t.length==r.length){for(var a=t.length,i=[],o=0;o<a;++o)i.push(Math.abs(t[o]-r[o]));return Math.max.apply(Math,i)}},t.cosine=function cosine(t,r){if(t.length===r.length){for(var a=t.length,i=0,o=0,u=0,l=0;l<a;++l)i+=t[l]*r[l],o+=t[l]*t[l],u+=r[l]*r[l];return Math.acos(i/(Math.sqrt(o)*Math.sqrt(u)))}},t.distance_matrix=distance_matrix,t.euclidean=euclidean,t.euclidean_squared=euclidean_squared,t.k_nearest_neighbors=k_nearest_neighbors,t.kahan_sum=function kahan_sum(t){for(var r,a,i=t.length,o=0,u=0,l=0;l<i;++l)u=(a=o+(r=t[l]-u))-o-r,o=a;return o},t.linspace=linspace,t.manhattan=function manhattan(t,r){if(t.length==r.length){for(var a=t.length,i=0,o=0;o<a;++o)i+=Math.abs(t[o]-r[o]);return i}},t.max=max,t.neumair_sum=neumair_sum,t.norm=norm,t.powell=powell,t.qr=qr,t.simultaneous_poweriteration=simultaneous_poweriteration$1,t.version="0.3.14",Object.defineProperty(t,"__esModule",{value:!0})}));
